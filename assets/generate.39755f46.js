(function(){"use strict";class g{constructor(o,e=!0){this.tiles=o,this.difficulty=-1,this.notes=[],e&&(this.notes=this.makeNotes())}getTile(o,e){let t=null;return this.tiles.forEach(n=>{n.row==o&&n.column==e&&(t=n)}),t}getCell(o){let e=[];return this.tiles.forEach(t=>{t.cell==o&&e.push(t)}),e}getRow(o){let e=[];for(let t=1;t<10;t++)e.push(this.getTile(o,t));return e}getColumn(o){let e=[];for(let t=1;t<10;t++)e.push(this.getTile(t,o));return e}makeNotes(){let o=[],e=729,t=81*9-1,n=1,i=[0,0];for(o=this.interpretNotes1(this.gatherNotes(o));n>0;)o=this.interpretNotes1(o),t=this.countPossibilities(o),n=e-t,i[0]+=n,n==0&&(o=this.interpretNotes2(o),n=t-this.countPossibilities(o),i[1]+=n),e=t;return e==0?this.difficulty=this.calcDifficulty(i[0],i[1]):this.difficulty=-1,o.concat()}calcDifficulty(o,e){return Math.min(Math.round((o+100*e)/(o+e)),4)}countPossibilities(o){let e=0;return o.forEach(t=>{t.notes.length>1&&(e+=t.notes.length-1)}),e}gatherNotes(o){let e=[];for(let t=0;t<9;t++)e.push(this.getCell(t));return e.forEach(t=>{t.forEach(n=>{typeof n.index!="number"&&o.push({cell:n.cell,row:n.row,column:n.column,notes:this.missing(t)})})}),o}interpretNotes1(o){let e=[];for(let l=1;l<10;l++)e.push(this.getRow(l));e.forEach((l,h)=>{let f=[];l.forEach(r=>{typeof r.index=="number"&&f.push(r.index)}),o.forEach(r=>{f.forEach(a=>{r.row==h+1&&r.notes.indexOf(a)>-1&&r.notes.splice(r.notes.indexOf(a),1)})})});let t=[];for(let l=1;l<10;l++)t.push(this.getColumn(l));t.forEach((l,h)=>{let f=[];l.forEach(r=>{typeof r.index=="number"&&f.push(r.index)}),o.forEach(r=>{f.forEach(a=>{r.column==h+1&&r.notes.indexOf(a)>-1&&r.notes.splice(r.notes.indexOf(a),1)})})});let n=[1,2,3,4,5,6,7,8,9],i=[];return n.forEach(l=>{let h=this.notesCol(o,l);h.forEach(f=>{f.notes.forEach(r=>{this.unique(h,r)&&i.push({cell:f.cell,row:f.row,column:f.column,index:r})})})}),n.forEach(l=>{let h=this.notesRow(o,l);h.forEach(f=>{f.notes.forEach(r=>{this.unique(h,r)&&i.push({cell:f.cell,row:f.row,column:f.column,index:r})})})}),i.forEach(l=>{this.unsetOthers(o,l)}),this.found(o).forEach(l=>{let h=this.notesRow(o,l.row);h.forEach(f=>{l.column!=f.column&&this.removeFromArray(f.notes,l.notes)}),h=this.notesCol(o,l.column),h.forEach(f=>{l.row!=f.row&&this.removeFromArray(f.notes,l.notes)})}),o}interpretNotes2(o){if(this.pass>0)return o;for(let e=0;e<3;e++){let t=o.concat(),n=this.addIndexToNotes(t),i=this.notesCell(n,e*3),s=[];s=this.characteristics2(i,0),s.length>0&&[0,1,2,3,4,5,6,7,8].forEach(r=>{var a=this.notesCell(o,e*3);a.forEach(c=>{s.find(u=>u.row==c.row)&&c.notes.indexOf(r)>-1&&!s.find(u=>u.n==r)&&c.notes.splice(c.notes.indexOf(r),1)})});let l=this.notesCell(n,e*3+1);s=this.characteristics2(l,0),s.length>0&&[0,1,2,3,4,5,6,7,8].forEach(r=>{var a=this.notesCell(o,e*3+1);a.forEach(c=>{s.find(u=>u.row==c.row)&&c.notes.indexOf(r)>-1&&!s.find(u=>u.n==r)&&c.notes.splice(c.notes.indexOf(r),1)})});let h=this.notesCell(n,e*3+2);s=this.characteristics2(h,0),s.length>0&&[0,1,2,3,4,5,6,7,8].forEach(r=>{var a=this.notesCell(o,e*3+2);a.forEach(c=>{s.find(u=>u.row==c.row)&&c.notes.indexOf(r)>-1&&!s.find(u=>u.n==r)&&c.notes.splice(c.notes.indexOf(r),1)})})}for(let e=0;e<3;e++){let t=o.concat(),n=this.addIndexToNotes(t),i=this.notesCell(n,e*3+Math.floor(e/3)*3),s=[];s=this.characteristics2(i,1),s.length>0&&[0,1,2,3,4,5,6,7,8].forEach(r=>{var a=this.notesCell(o,e*3+Math.floor(e/3)*3);a.forEach(c=>{s.find(u=>u.column==c.column)&&c.notes.indexOf(r)>-1&&!s.find(u=>u.n==r)&&c.notes.splice(c.notes.indexOf(r),1)})});let l=this.notesCell(n,e*3+Math.floor(e/3)*3+1);s=this.characteristics2(l,1),s.length>0&&[0,1,2,3,4,5,6,7,8].forEach(r=>{var a=this.notesCell(o,e*3+Math.floor(e/3)*3+1);a.forEach(c=>{s.find(u=>u.column==c.column)&&c.notes.indexOf(r)>-1&&!s.find(u=>u.n==r)&&c.notes.splice(c.notes.indexOf(r),1)})});let h=this.notesCell(n,e*3+Math.floor(e/3)*3+2);s=this.characteristics2(h,1),s.length>0&&[0,1,2,3,4,5,6,7,8].forEach(r=>{var a=this.notesCell(o,e*3+Math.floor(e/3)*3+2);a.forEach(c=>{s.find(u=>u.column==c.column)&&c.notes.indexOf(r)>-1&&!s.find(u=>u.n==r)&&c.notes.splice(c.notes.indexOf(r),1)})})}for(let e=1;e<10;e++){let t=this.notesCell(o.concat(),e-1),n=this.characteristics(t);t=this.addIndexToNotes(t,2,e-1),this.found(t).length<9&&n.forEach(i=>{i.col,i.row}),t=this.notesRow(o.concat(),e),n=this.characteristics(t),t=this.addIndexToNotes(t,0,e),this.found(t).length<9&&n.forEach(i=>{i.cell}),t=this.notesCol(o.concat(),e),n=this.characteristics(t),t=this.addIndexToNotes(t,1,e),this.found(t).length<9&&n.forEach(i=>{i.cell}),t=this.notesCell(o.concat(),e-1),n=[],n=this.threeTwoTwo(t),n.length>0&&this.found(t).length<9&&n.forEach(i=>{this.removeFromCell(o,i.row,i.column,i.cell,i.notes)})}for(let e=1;e<10;e++)for(let t=0;t<9;t++){let n=this.notesCell(o,e),i=this.findDigitInNotes(n,t);i.length==1&&(i[0].notes=[t])}return o}isValid(o){let e=!0;return(o||this.notes).forEach(n=>{let i=this.getTile(n.row,n.column);n.notes.length==0&&typeof i.index!="number"&&(e=!1)}),e}unsetCell(o){this.getCell(o).forEach(t=>{t.index=""})}removeIndex(){let o=-1,e=-1,t=null,n="",i=0;for(;i<81*2;)if(o=Math.round(Math.random()*8)+1,e=Math.round(Math.random()*8)+1,t=this.getTile(o,e),n="",typeof t.index=="number"){if(n=t.index,t.index="",this.makeNotes()&&this.difficulty>0)break;t.index=n,i++}return{row:o,col:e,index:n}}makeHints(o,e){let t=[],n=!0;for(let i=0;i<o;i++)t.push(this.removeIndex());return this.notes=this.makeNotes(),(this.difficulty>e+.5||this.difficulty<e)&&(t.forEach(i=>{let s=this.getTile(i.row,i.col);s.index=i.index}),this.notes=[],n=!1),n}validSudoku(){let o=!0,e=0;return this.tiles.forEach(t=>{typeof t.index=="number"?e++:!t.notes||t.notes.length!=1?o=!1:e++}),o&&e==81}generate(o=1){console.log("start generate"),console.time("generate");for(let f=0;f<9;f++)this.unsetCell(f);let e=[9,8,7,6,5,4,3,2,1],t=9,n=this.makeNotes(),i=[];for(;e.length>0&&!this.validSudoku();){t=e.shift(),n=this.makeNotes(),i=[];for(var s=0;s<n.length;s++)n[s].notes.length==t&&i.push(n[s]);let f=Math.round(Math.random()*(i.length-1)),r=null;this.tiles.forEach(a=>{i[f]&&i[f].row==a.row&&i[f].column==a.column&&(r=a,a.index=i[f].notes[Math.round(Math.random()*(i[f].notes.length-1))])}),this.isValid(this.makeNotes())||(r.index=""),!this.validSudoku()&&e.length==0&&(e=[9,8,7,6,5,4,3,2,1])}let l=[28,26,24,22],h=81-l[o-1];for(;!this.makeHints(h,o););return this.tiles.forEach(f=>{typeof f.index=="number"&&(f.initialValue=!0)}),console.timeEnd("generate"),this.tiles}getNote(o,e,t){let n=null;return o.forEach(i=>{i.row==e&&i.column==t&&(n=i)}),n}isPossible(o,e,t){return this.getNote(t,o.row,o.column).notes.indexOf(e)>-1}addIndexToNotes(o,e,t){let n=[];return this.tiles.forEach(i=>{typeof i.index=="number"&&(e==0&&t==i.row||e==1&&t==i.column||e==2&&t==i.cell)&&(i.notes=[i.index],n.push(i))}),o.concat(n)}notesCell(o,e){let t=[];return o.forEach(n=>{n.cell==e&&(t=t.concat(n))}),t}notesRow(o,e){let t=[];return o.forEach(n=>{n.row==e&&(t=t.concat(n))}),t}notesCol(o,e){let t=[];return o.forEach(n=>{n.column==e&&(t=t.concat(n))}),t}unsetOthers(o,e){o.forEach(t=>{t.row==e.row&&t.column==e.column?t.notes=[e.index]:(e.cell==t.cell&&t.notes.indexOf(e.index)>-1||e.row==t.row&&t.notes.indexOf(e.index)>-1||e.row==t.row&&t.notes.indexOf(e.index)>-1)&&t.notes.splice(t.notes.indexOf(e.index),1)})}allOnRow(o){let e=null;return o.forEach(t=>{t.notes.forEach(n=>{typeof e=="object"?e=t.row:e!=t.row?e=-1:e>-1&&(e=t.row)})}),typeof e=="object"?-1:e}allOnColumn(o){let e=null;return o.forEach(t=>{t.notes.forEach(n=>{typeof e=="object"?e=t.column:e!=t.column?e=-1:e>-1&&(e=t.column)})}),typeof e=="object"?-1:e}findDigitInNotes(o,e){let t=[];return o.forEach(n=>{n.notes.indexOf(e)>-1&&t.push(n)}),t}findIndentical(o){let e=[];return o.forEach((t,n)=>{o.forEach((i,s)=>{this.identical(t.notes,i.notes)&&s<n&&!this.contains(e,t)&&(e.push(t),e.push(i))})}),e}contains(o,e){return typeof o.find(n=>{if(n.row==e.row&&n.column==e.column)return n})!="undefined"}found(o){let e=[];return o.forEach(t=>{t.notes.length==1&&e.push(t)}),e}found2(o){let e=[];return o.forEach(t=>{e.push(t.notes)}),e}missing(o){let e=[0,1,2,3,4,5,6,7,8];return o.forEach(t=>{typeof t.index=="number"&&e.splice(e.indexOf(t.index),1)}),e}occurences(o,e){let t=0;return o.forEach(n=>{n.notes.forEach(i=>{i===e&&t++})}),t}identical(o,e){let t=[];return o.forEach(n=>{t.push(n)}),e.forEach(n=>{t.indexOf(n)>-1?t.splice(t.indexOf(n),1):t.push(null)}),t.length===0}threeTwoTwo(o){let e=o.concat(),t=[];e.forEach(r=>{r.notes.forEach(a=>{let c=t.findIndex(u=>{if(u.digit==a)return u});c>-1?(t[c].n++,t[c].rows.push(r.row),t[c].columns.push(r.column)):t.push({digit:a,rows:[r.row],columns:[r.column],n:1})})});let n=[],i=[];t.forEach(r=>{r.n==2?n.push(r):r.n==3&&i.push(r)});let s=[],l=[];n.length>0&&(l=l.concat(n)),i.length>0&&(l=l.concat(i)),t.forEach(r=>{s.push(r.digit)}),e=o.concat(),s=[],l.length==3&&l.forEach(r=>{s.push(r)});let h=[];if([].concat(n,i).forEach(r=>{r.rows.forEach((a,c)=>{h.find(d=>{if(d.row==r.rows[c]&&d.column==r.columns[c])return d})||h.push({row:r.rows[c],column:r.columns[c]})})}),h.length==3&&n.length==2&&i.length==1){let r=null,a=null,c=null;i.forEach((d,p)=>{let E=null;n.forEach(w=>{w.digit==d.digit&&(E=!0)}),E||(r=d.digit,a=d.columns[p],c=d.rows[p])});let u=[];return i.forEach(d=>{d.digit==r&&d.rows.forEach((p,E)=>{let w=o.find(m=>{if(m.row==d.rows[E]&&m.column==d.columns[E])return m});if(w){let m=w.notes.concat();d.rows[E]==c&&d.columns[E]==a?m.splice(m.indexOf(r),1):m=[r],u.push({notes:m,row:w.row,column:w.column,cell:w.cell})}})}),u}return[]}characteristics2(o,e){let t=[0,1,2,3,4,5,6,7,8],n=[],i=[];return e==0?(n=[],t.forEach(s=>{let l=[];o.forEach(h=>{h.notes.indexOf(s)>-1&&l.indexOf(h.row)==-1&&l.push(h.row)}),l.length==1&&n.push({n:s,row:l[0]})}),t.forEach(s=>{let l=0;n.forEach(h=>{h.row==s&&l++}),l==3&&(i=i.concat(n))})):e==1&&(n=[],t.forEach(s=>{let l=[];o.forEach(h=>{h.notes.indexOf(s)>-1&&l.indexOf(h.column)==-1&&l.push(h.column)}),l.length==1&&n.push({n:s,column:l[0]})}),t.forEach(s=>{let l=0;n.forEach(h=>{h.column==s&&l++}),l==3&&(i=i.concat(n))})),i}characteristics(o){let e=[0,1,2,3,4,5,6,7,8],t=[];return e.forEach(n=>{let i=[],s=[],l=[];o.forEach(h=>{h.notes.forEach(f=>{i.indexOf(h.row)==-1&&f==n&&i.push(h.row),s.indexOf(h.column)==-1&&f==n&&s.push(h.column),l.indexOf(h.cell)==-1&&f==n&&l.push(h.cell+1)})}),i.length==1&&t.push({index:n,row:i[0]}),s.length==1&&t.push({index:n,col:s[0]}),l.length==1&&t.push({index:n,cell:l[0]})}),t}notTaken(o){let e=[0,1,2,3,4,5,6,7,8];return o.forEach(t=>{typeof t.index=="number"&&e.splice(e.indexOf(t.index),1)}),e}removeFromCell(o,e,t,n,i){o.forEach(s=>{typeof e=="number"?typeof n=="number"?n>0?s.cell!=n-1&&s.row==e&&this.removeFromArray(s.notes,i):s.cell==-1*n-1&&s.row!=e&&this.removeFromArray(s.notes,i):s.row!=e&&this.removeFromArray(s.notes,i):typeof t=="number"&&(typeof n=="number"?n>0?s.cell!=n-1&&s.column==t&&this.removeFromArray(s.notes,i):s.cell==-1*n-1&&s.column!=t&&this.removeFromArray(s.notes,i):s.column!=t&&this.removeFromArray(s.notes,i))})}removeFromArray(o,e){e.forEach(t=>{o.indexOf(t)>-1&&o.splice(o.indexOf(t),1)})}unique(o,e){return this.occurences(o,e)===1}uniqueNotes(o){let e=!0;return o.forEach((t,n)=>{o.forEach((i,s)=>{s<n&&this.identical(t.notes,i.notes)&&(e=!1)})}),e}getDifficulty(){return this.isValid()?this.difficulty:-1}getNotes(){return this.notes}}var O={sudoku:g};addEventListener("message",x=>{let o=!1;for(;!o;){let e=new O.sudoku(JSON.parse(x.data.tiles)),t=e.generate(x.data.d),n=e.getNotes(),i=e.getDifficulty();i>0?(o=!0,postMessage({tiles:t,notes:n,d:i})):e=null}})})();
